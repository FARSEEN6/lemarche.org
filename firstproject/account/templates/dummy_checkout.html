{% extends "index.html" %}
{% block title %}Payment – Le Marche{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">Payment</h2>

  <div class="card p-4 shadow text-center">
    <h4>Total Payable</h4>
    <h2 class="mb-4">₹ {{ total }}</h2>

    <button id="rzp-button" class="btn btn-dark w-100">
      Pay Securely with Razorpay
    </button>
  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
var options = {
    "key": "{{ razorpay_key }}",
    "amount": "{{ razorpay_amount }}",
    "currency": "INR",
    "name": "Le Marche",
    "description": "Order Payment",
    "order_id": "{{ razorpay_order_id }}",
    "handler": function (response) {
        fetch("{% url 'razorpay_success' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify(response)
        }).then(() => {
            window.location.href = "{% url 'dummy_payment_success' %}";
        });
    },
    "theme": {
        "color": "#000000"
    }
};

var rzp1 = new Razorpay(options);
document.getElementById("rzp-button").onclick = function (e) {
    rzp1.open();
    e.preventDefault();
}
</script>
{% endblock %}
